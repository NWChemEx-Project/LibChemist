<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing the Fragmented System Component &mdash; Chemist 0.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Designing the FragmentedMolecule Class" href="fragmented_molecule.html" />
    <link rel="prev" title="Chemical System Design" href="system.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Chemist
          </a>
              <div class="version">
                0.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview of Chemist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sparse_maps/index.html">Sparse Maps Sublibrary</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Design Documentation</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#overview">Overview</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../architecture.html">Architecture of Chemist</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Designing the Chemistry Sublibrary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#physics">Physics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="https://nwchemex-project.github.io/.github/">Developing for the NWChemEx Organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://nwchemex-project.github.io/Chemist/chemist_cxx_api/index.html">C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Chemist</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Developer Documentation</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Design Documentation</a></li>
          <li class="breadcrumb-item"><a href="index.html">Designing the Chemistry Sublibrary</a></li>
      <li class="breadcrumb-item active">Designing the Fragmented System Component</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/developer/design/chemistry/fragmented_system.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="designing-the-fragmented-system-component">
<span id="designing-fragmented-system"></span><h1>Designing the Fragmented System Component<a class="headerlink" href="#designing-the-fragmented-system-component" title="Permalink to this heading"></a></h1>
<p>The point of this page is to record the design process of the
<code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class and affiliated classes.</p>
<div class="section" id="what-is-a-fragmented-system">
<h2>What is a Fragmented System?<a class="headerlink" href="#what-is-a-fragmented-system" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> (main discussion: <a class="reference internal" href="system.html#csd-chemical-system-design"><span class="std std-ref">Chemical System Design</span></a>)
represents the physical system we are trying to model. For traditional
electronic structure calculations the <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> is the part of the
input independent from the method/model specification. Many approximate
methods require breaking the target chemical system up into subsets. We term
those subsets fragments and a <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> is a <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code>
which has been decomposed into fragment/field pairs.</p>
</div>
<div class="section" id="why-do-we-need-a-fragmentedsystem">
<h2>Why do we need a FragmentedSystem?<a class="headerlink" href="#why-do-we-need-a-fragmentedsystem" title="Permalink to this heading"></a></h2>
<p>As mentioned, there are a number of approximate methods — <em>e.g.</em>, QM/MM,
fragment based-methods, electronic embedding, and symmetry-adpated perturbation
theory — which require fragmenting the physical system of interest into a
series of subsystems. The <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class allows us to represent
fragments of the original <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> along with the field the fragment is
embedded in.</p>
</div>
<div class="section" id="fragmentedsystem-considerations">
<h2>FragmentedSystem Considerations<a class="headerlink" href="#fragmentedsystem-considerations" title="Permalink to this heading"></a></h2>
<p>Ultimately the <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class will end up paralleling the
<code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> class and thus many of the considerations in
<a class="reference internal" href="system.html#csd-considerations"><span class="std std-ref">Chemical System Design Considerations</span></a> apply here too. In addition:</p>
<dl class="simple" id="fs-hierarchy">
<dt>Hierarchy</dt><dd><p>While we have talked about a single <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class up until this
point, the <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> class we intend to fragment is itself a
hierarchy. It thus makes sense to parallel the <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code>
hierarchy with a “fragmented” system hierarchy.</p>
</dd>
</dl>
<dl class="simple" id="fs-fields">
<dt>Fields.</dt><dd><p>Each fragment may have a different field associated with it. The
<code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> needs to know the field of each fragment.</p>
<ul class="simple">
<li><p>Assigning fields to a fragment usually requires knowledge of the original
<code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> and the <code class="docutils literal notranslate"><span class="pre">FragmentedMolecule</span></code> object.</p></li>
<li><p>Some fields are subsets of the field for the entire system.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="fs-performance">
<dt>Performance</dt><dd><p>It is expected that the implementation under the hood will need to be
somewhat clever in how it stores data and preserves fragment mapping. Of
note, for fragment-based methods the number of fragments often grows
exponetially with system size (many of those fragments need not be
considered, but that’s a different problem). Storing an exponential number
of copies (even if those copies are only subsets) gets expensive quickly.</p>
<ul class="simple">
<li><p>Views allow array-of-structures API, while maintaining structure-of-array
innards.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="fs-container">
<dt>Container</dt><dd><p><code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> is essentially a set of fragments. In terms of C++
concepts this means the <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class should be container-like.</p>
</dd>
</dl>
<dl class="simple" id="fs-generality">
<dt>Generality</dt><dd><p>Ideally the <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class should be applicable to as many
methods which rely on fragments as possible. To this extent the class should
be able to handle:</p>
<ul class="simple">
<li><p>Disjoint and non-disjoint fragments.</p></li>
<li><p>Covalently-bonded fragments.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="fs-chemical-system-compatability">
<dt>ChemicalSystem compatability.</dt><dd><p>Following from the <a class="reference internal" href="#fs-container"><span class="std std-ref">Container</span></a> consideration, <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code>
will conceptually be a container filled with <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> objects. We
anticipate that the primary usage of the <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class will be
to pass elements of the container to algorithms which expect
<code class="docutils literal notranslate"><span class="pre">ChemicqlSystem</span></code> objects.</p>
</dd>
</dl>
<div class="section" id="out-of-scope">
<h3>Out of Scope<a class="headerlink" href="#out-of-scope" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>Expansion coefficients.</dt><dd><p>Usually the properties of the fragments are combined as a linear combination.
The weights of this linear expansion will be stored elsewhere. Part of the
motivation for not including the weights here is that in many cases the
weights depend on more than just the fragment/field, <em>e.g.</em>, they may also
depend on the AO basis set (think basis set superposition error corrections)
and/or level of theory (think QM/MM or other multi-layered theories).</p>
</dd>
<dt>AO Basis Sets.</dt><dd><p>For the same reason we considered the AO Basis Set out of scope from the
<code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code>, it is also out of scope here. See
<a class="reference internal" href="system.html#csd-considerations"><span class="std std-ref">Chemical System Design Considerations</span></a> for more details.</p>
</dd>
<dt><span class="math notranslate nohighlight">\(n\)</span>-mers.</dt><dd><p>In fragment-based methods based off of the many-body expansion, one often
starts with a set of fragments. Typically these fragments are chosen to
contain atoms residing proximal to one another. To capture many-body
interactions among the fragments, one then forms unions of pairs, triples,
up to <span class="math notranslate nohighlight">\(n\)</span>-tuples of fragments. The resulting unions are termed
<span class="math notranslate nohighlight">\(n\)</span>-mers. From the perspective of running calculations <span class="math notranslate nohighlight">\(n\)</span>-mers
are no different tha a non-disjoint use of <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code>. That said,
having a class which can express the <span class="math notranslate nohighlight">\(n\)</span>-mer relationship is useful
for other purposes, e.g., screening the final set of <span class="math notranslate nohighlight">\(n\)</span>-mers and
basis-set superposition corrections, and thus should exist. Here we simply
advocate for that class being different than the <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="fragmented-system-design">
<h2>Fragmented System Design<a class="headerlink" href="#fragmented-system-design" title="Permalink to this heading"></a></h2>
<div class="figure align-center" id="id1">
<span id="fig-fragmented-system-design"></span><img alt="../../../_images/fragmented_system.png" src="../../../_images/fragmented_system.png" />
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">How the major pieces of the <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> map to pieces of the
fragmented system.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</div>
<p>As <a class="reference internal" href="#fig-fragmented-system-design"><span class="std std-numref">Fig. 2</span></a> shows, in satisfying
<a class="reference internal" href="#fs-hierarchy"><span class="std std-ref">Hierarchy</span></a> we have opted to mirror the existing <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code>
hierarchy. More specifically, what was the <code class="docutils literal notranslate"><span class="pre">Nuclei</span></code> in the original
<code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> becomes the <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code> (subsets of the original
nuclei), what was the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> becomes the <code class="docutils literal notranslate"><span class="pre">FragmentedMolecule</span></code> (subsets
of the original atoms), and what was the <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> becomes the
<code class="docutils literal notranslate"><span class="pre">FragmentedChemicalSystem</span></code>. These three major components are described briefly
in the following subsections.</p>
<div class="section" id="fragmentednuclei-class">
<h3>FragmentedNuclei Class<a class="headerlink" href="#fragmentednuclei-class" title="Permalink to this heading"></a></h3>
<p>Main page: <a class="reference internal" href="fragmented_nuclei.html#designing-fragmented-nuclei"><span class="std std-ref">Designing the Fragmented Nuclei Class</span></a>.</p>
<p>Most algorithms for fragmenting a molecular system focus on the nuclei. Given
a <code class="docutils literal notranslate"><span class="pre">Nuclei</span></code> object, a <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code> is a container whose elements are
subsets of <code class="docutils literal notranslate"><span class="pre">Nuclei</span></code>. As shown in <a class="reference internal" href="#fig-fragmented-system-design"><span class="std std-numref">Fig. 2</span></a> the
actual elements are <code class="docutils literal notranslate"><span class="pre">NucleiView</span></code> objects, which behave like a <code class="docutils literal notranslate"><span class="pre">Nuclei</span></code>
object, but do not own their state. As users create fragments from the
<code class="docutils literal notranslate"><span class="pre">Nuclei</span></code> class they add them to the <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code> object, which tracks
them.</p>
</div>
<div class="section" id="fragmentedmolecule-class">
<h3>FragmentedMolecule Class<a class="headerlink" href="#fragmentedmolecule-class" title="Permalink to this heading"></a></h3>
<p>Main page: <a class="reference internal" href="fragmented_molecule.html#designing-fragmented-molecule-class"><span class="std std-ref">Designing the FragmentedMolecule Class</span></a>.</p>
<p>As shown in <a class="reference internal" href="#fig-fragmented-system-design"><span class="std std-numref">Fig. 2</span></a> the <code class="docutils literal notranslate"><span class="pre">FragmentedMolecule</span></code>
class has three components: a <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code> object, the caps for each
element in the <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code> object, and a mapping from
the elements of the <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code> to their respective
charge/multiplicities. The <code class="docutils literal notranslate"><span class="pre">Caps</span></code> object is needed to deal with severed
valencies.</p>
</div>
<div class="section" id="fragmentedsystem-class">
<h3>FragmentedSystem Class<a class="headerlink" href="#fragmentedsystem-class" title="Permalink to this heading"></a></h3>
<p>As shown in <a class="reference internal" href="#fig-fragmented-system-design"><span class="std std-numref">Fig. 2</span></a>, the <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code>
class has two pieces: a <code class="docutils literal notranslate"><span class="pre">FragmentedMolecule</span></code> object and a mapping from the
elements of the <code class="docutils literal notranslate"><span class="pre">FragmentedMolecule</span></code> object to their respective fields. At</p>
</div>
</div>
<div class="section" id="fragmentedsystem-summary">
<h2>FragmentedSystem Summary<a class="headerlink" href="#fragmentedsystem-summary" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt><a class="reference internal" href="#fs-hierarchy"><span class="std std-ref">Hierarchy</span></a></dt><dd><p>As <a class="reference internal" href="#fig-fragmented-system-design"><span class="std std-numref">Fig. 2</span></a> shows the nesting of the
<code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class mirrors that of the <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> class.</p>
</dd>
<dt><a class="reference internal" href="#fs-fields"><span class="std std-ref">Fields.</span></a></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class internally contains a list of fields for
each element of the <code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code>.</p>
</dd>
<dt><a class="reference internal" href="#fs-performance"><span class="std std-ref">Performance</span></a></dt><dd><p>The design relies on views for accessing elements of the
<code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code>, <code class="docutils literal notranslate"><span class="pre">FragmentedMolecule</span></code>, and <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code>.
In turn, the innards of the classes are free to store the fragmentation
information in whatever format is convenient for performance.</p>
</dd>
<dt><a class="reference internal" href="#fs-container"><span class="std std-ref">Container</span></a></dt><dd><p>The adherenance to the container concept is reflected in the API of the
<code class="docutils literal notranslate"><span class="pre">FragmentedSystem</span></code> class which is not shown in
<a class="reference internal" href="#fig-fragmented-system-design"><span class="std std-numref">Fig. 2</span></a>.</p>
</dd>
<dt><a class="reference internal" href="#fs-generality"><span class="std std-ref">Generality</span></a></dt><dd><p>In this design, disjoint/non-disjoint and covalent vs. non-covalent are
considerations for the <code class="docutils literal notranslate"><span class="pre">FragmentedNuclei</span></code> and <code class="docutils literal notranslate"><span class="pre">FragmentedMolecule</span></code>
classes respectively.</p>
</dd>
<dt><a class="reference internal" href="#fs-chemical-system-compatability"><span class="std std-ref">ChemicalSystem compatability.</span></a></dt><dd><p>Not apparent from <a class="reference internal" href="#fig-fragmented-system-design"><span class="std std-numref">Fig. 2</span></a>, but impacts the
API of the <code class="docutils literal notranslate"><span class="pre">ChemicalSystemView</span></code> class. Namely, the <code class="docutils literal notranslate"><span class="pre">ChemicalSystemView</span></code>
class needs to be easily converted to a <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> class.</p>
</dd>
</dl>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="system.html" class="btn btn-neutral float-left" title="Chemical System Design" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fragmented_molecule.html" class="btn btn-neutral float-right" title="Designing the FragmentedMolecule Class" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, NWChemEx Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>