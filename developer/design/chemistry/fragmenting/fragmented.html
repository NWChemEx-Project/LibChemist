<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing the Fragmented Class &mdash; Chemist 0.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Designing the Fragmented PIMPL Classes" href="fragmented_pimpls.html" />
    <link rel="prev" title="Designing the Fragmenting Component" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Chemist
          </a>
              <div class="version">
                0.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">Overview of Chemist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sparse_maps/index.html">Sparse Maps Sublibrary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../background/index.html">Chemist Background</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Design Documentation</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html#overview">Overview</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../architecture.html">Architecture of Chemist</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../index.html">Designing the Chemistry Sublibrary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#physics">Physics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="https://nwchemex-project.github.io/.github/">Developing for the NWChemEx Organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Chemist Tutorials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nwchemex-project.github.io/Chemist/chemist_cxx_api/index.html">C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Chemist</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Developer Documentation</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Design Documentation</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Designing the Chemistry Sublibrary</a></li>
          <li class="breadcrumb-item"><a href="index.html">Fragmenting Subcomponent</a></li>
      <li class="breadcrumb-item active">Designing the Fragmented Class</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/developer/design/chemistry/fragmenting/fragmented.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="designing-the-fragmented-class">
<span id="designing-fragmented-class"></span><h1>Designing the Fragmented Class<a class="headerlink" href="#designing-the-fragmented-class" title="Permalink to this heading"></a></h1>
<p>This page describes the design of the <code class="docutils literal notranslate"><span class="pre">Fragmented</span></code> class.</p>
<section id="what-is-the-fragmented-class">
<h2>What is the Fragmented Class?<a class="headerlink" href="#what-is-the-fragmented-class" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class represents a “superset” <code class="docutils literal notranslate"><span class="pre">T</span></code> object which has
been broken into subsets. The elements in the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class are
the pieces of the superset, i.e., the fragments.</p>
</section>
<section id="why-do-we-need-a-fragmented-class">
<h2>Why Do We Need a Fragmented Class?<a class="headerlink" href="#why-do-we-need-a-fragmented-class" title="Permalink to this heading"></a></h2>
<p>The overall architecture of the Fragmenting component
(see <a class="reference internal" href="overview.html#designing-the-fragmenting-component"><span class="std std-ref">Designing the Fragmenting Component</span></a>) requires a <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code>
class template in order to represent a fragmented <code class="docutils literal notranslate"><span class="pre">T</span></code> object. More generally,
we have opted to write a new class, instead of using say a
<code class="docutils literal notranslate"><span class="pre">std::vector&lt;std::set&lt;T&gt;&gt;</span></code> object, for performance reasons. In particular, we
want to avoid copying members of the superset <code class="docutils literal notranslate"><span class="pre">T</span></code> object, which requires some
indirection in the implementation.</p>
</section>
<section id="fragmented-considerations">
<h2>Fragmented Considerations<a class="headerlink" href="#fragmented-considerations" title="Permalink to this heading"></a></h2>
<dl class="simple" id="fc-additional-state">
<dt>additional state</dt><dd><p>The overall design of the Fragmenting component
(<a class="reference internal" href="overview.html#designing-the-fragmenting-component"><span class="std std-ref">Designing the Fragmenting Component</span></a>) laid out the container-like
nature of <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> objects. In practice, some of the objects we are
fragmenting are not pure containers but have container-wide state. This
additional state will need to be specially handled by the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code>
class.</p>
<ul class="simple">
<li><p>As a concrete example, the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> class is not simply a container of
<code class="docutils literal notranslate"><span class="pre">Nucleus</span></code> objects, but also knows the total number of electrons and the
overall multiplicity of the molecular system. While we can track which
nuclei are in the fragment by offset, we must additionally explicitly store
the number of electrons and multiplicity of the fragment as well.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="fc-non-disjoint2">
<dt>non-disjoint</dt><dd><p>The discussion on the <a class="reference internal" href="overview.html#designing-the-fragmenting-component"><span class="std std-ref">Designing the Fragmenting Component</span></a> page
charged the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class with being able to handle non-disjoint
fragments.</p>
</dd>
</dl>
<dl class="simple" id="fc-null-and-empty-states">
<dt>null and empty states</dt><dd><p>The default constructed object should represent a null state, such a
state does not even have a supersystem set. There is also an empty state
where the supersystem is set, but the object may not contain any fragments.</p>
<ul class="simple">
<li><p>The superset is part of the state and is involved in all operations.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="fc-overall-state">
<dt>overall state</dt><dd><p>Collecting requirements from <a class="reference internal" href="overview.html#designing-the-fragmenting-component"><span class="std std-ref">Designing the Fragmenting Component</span></a> and
the above considerations, the internal state of a <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class
must contain:</p>
<ul class="simple">
<li><p>the superset,</p></li>
<li><p>the members of each fragment,</p></li>
<li><p>additional state associated with each fragment,</p></li>
<li><p>and the caps.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="fragmented-design">
<h2>Fragmented Design<a class="headerlink" href="#fragmented-design" title="Permalink to this heading"></a></h2>
<figure class="align-center" id="id1">
<span id="fig-fragmented-class"></span><img alt="../../../../_images/fragmented.png" src="../../../../_images/fragmented.png" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Classes related to implementing the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class template.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Consideration <a class="reference internal" href="#fc-additional-state"><span class="std std-ref">additional state</span></a> means that <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> will need
to contain <code class="docutils literal notranslate"><span class="pre">T</span></code>-specific state. While specialization is an option,
specialization of a class template requires redefining all members of the class
for every specialization. Since we anticipate needing to do this for every
value of <code class="docutils literal notranslate"><span class="pre">T</span></code> we would essentially end up writing independent classes.
However, we anticipate that the implementations for these specializations will
contain some level of replicated code, which we would like to factor out. Our
solution is shown in <a class="reference internal" href="#fig-fragmented-class"><span class="std std-ref">Classes related to implementing the Fragmented&lt;T&gt; class template.</span></a>.</p>
<p>As <a class="reference internal" href="#fig-fragmented-class"><span class="std std-ref">Classes related to implementing the Fragmented&lt;T&gt; class template.</span></a> shows <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> is not specialized,
rather its PIMPL, <code class="docutils literal notranslate"><span class="pre">FragmentedPIMPL&lt;T&gt;</span></code> is. This solution allows us to
implement common functionality in the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class template in terms
of a common set of functions each specialization of <code class="docutils literal notranslate"><span class="pre">FragmentedPIMPL&lt;T&gt;</span></code>
must implement. In turn the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class relies on static
polymorphism to address the <a class="reference internal" href="#fc-additional-state"><span class="std std-ref">additional state</span></a> consideration.
Conceptually, the static polymorphism in this case works similar to duck-typing
in Python, namely the
<code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> object doesn’t really care about the exact signatures of the
PIMPL’s functions so long as a function with that name exists and can accept
whatever arguments the user provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Full PIMPL design discussions: <a class="reference internal" href="fragmented_pimpls.html#designing-fragmented-pimpls"><span class="std std-ref">Designing the Fragmented PIMPL Classes</span></a>.</p>
</div>
<p>While the exact details of the PIMPLs are out of scope for this discussion, we
note that the PIMPL design will be similar to the design of the
<code class="docutils literal notranslate"><span class="pre">Molecule</span></code> and <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> classes (see <a class="reference internal" href="../molecule.html#md-molecule-design"><span class="std std-ref">Molecule Design</span></a>
and <a class="reference internal" href="../system.html#csd-chemical-system-design"><span class="std std-ref">Chemical System Design</span></a> respectively). More specifically, the
<code class="docutils literal notranslate"><span class="pre">FragmentedPIMPL&lt;Molecule&gt;</span></code> class will contain a <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;Nuclei&gt;</span></code>
instance plus the additional <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> state for each fragment, and the
<code class="docutils literal notranslate"><span class="pre">FragmentedPIMPL&lt;ChemicalSystem&gt;</span></code> will contain a <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;Molecule&gt;</span></code>
instance plus the additional <code class="docutils literal notranslate"><span class="pre">ChemicalSystem</span></code> state for each fragment.</p>
</section>
<section id="fragmented-api">
<h2>Fragmented API<a class="headerlink" href="#fragmented-api" title="Permalink to this heading"></a></h2>
<p>To construct a <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> object:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// In this code snippet T is assumed to be Nuclei, Molecule, or</span>
<span class="c1">// ChemicalSystem</span>

<span class="c1">// We somehow make a supersystem object</span>
<span class="n">T</span><span class="w"> </span><span class="n">supersys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_supersystem</span><span class="p">();</span>

<span class="c1">// Fragmented objects need to know the supersystem the refer to</span>
<span class="c1">// (could also move to avoid the copy)</span>
<span class="n">Fragmented</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fragments</span><span class="p">(</span><span class="n">supersys</span><span class="p">);</span>

<span class="c1">// Default construction is null, not empty</span>
<span class="n">Fragmented</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">null</span><span class="p">;</span>
</pre></div>
</div>
<p>Following from consideration <a class="reference internal" href="#fc-null-and-empty-states"><span class="std std-ref">null and empty states</span></a>, <code class="docutils literal notranslate"><span class="pre">fragments</span></code> will
be an empty set of fragments whereas <code class="docutils literal notranslate"><span class="pre">null</span></code> will be a null object. Because
fragment creation is somewhat involved we do not anticipate users having a set
of fragments ready when creating a <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> object. Rather we expect
fragments to be added dynamically via an algorithm; examples of filling in
fragments were shown in <a class="reference internal" href="overview.html#fragmenting-api"><span class="std std-ref">Fragmenting API</span></a>. Once <code class="docutils literal notranslate"><span class="pre">fragments</span></code> is filled
in we expect users to want to be able to access its state:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// How many fragments?</span>
<span class="n">fragments</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

<span class="c1">// Access the supersystem</span>
<span class="n">assert</span><span class="p">(</span><span class="n">fragments</span><span class="p">.</span><span class="n">supersystem</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">supersys</span><span class="p">);</span>

<span class="c1">// Loop over fragments and print them</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">frag_i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">frag_i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt><a class="reference internal" href="#fc-additional-state"><span class="std std-ref">additional state</span></a></dt><dd><p>The fact that some supersystems contain state beyond simply being a container
is handled by specializing <code class="docutils literal notranslate"><span class="pre">FragmentedPIMPL&lt;T&gt;</span></code> for each <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</dd>
<dt><a class="reference internal" href="#fc-non-disjoint2"><span class="std std-ref">non-disjoint</span></a></dt><dd><p>This consideration will primarily apply to <code class="docutils literal notranslate"><span class="pre">FragmentedPIMPL&lt;Nuclei&gt;</span></code> which
is charged with knowing which <code class="docutils literal notranslate"><span class="pre">Nucleus</span></code> objects are assigned to which
fragments. Common functionality implemented in the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> class
template will not assume that fragments are disjoint, nor will it enforce
disjointedness.</p>
</dd>
<dt><a class="reference internal" href="#fc-null-and-empty-states"><span class="std std-ref">null and empty states</span></a></dt><dd><p>The default constructor will create a null object, whereas the constructor
which takes a superset creates an empty object.</p>
</dd>
<dt><a class="reference internal" href="#fc-overall-state"><span class="std std-ref">overall state</span></a></dt><dd><p>Storing the state of the <code class="docutils literal notranslate"><span class="pre">Fragmented&lt;T&gt;</span></code> object largely falls to the
various PIMPL classes.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Designing the Fragmenting Component" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fragmented_pimpls.html" class="btn btn-neutral float-right" title="Designing the Fragmented PIMPL Classes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, NWChemEx Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>